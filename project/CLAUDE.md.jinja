# CLAUDE.md

This file provides guidance for AI assistants working on this codebase.

## Project Overview

**{{ project_name }}** - Python package managed with [uv](https://github.com/astral-sh/uv).

| Attribute | Value |
|-----------|-------|
| Package | `{{ python_package_distribution_name }}` |
| Import | `{{ python_package_import_name }}` |
| Python | {{ python_version }} |

## Quick Reference

```bash
uvx --from taskipy task setup        # Install dependencies
uvx --from taskipy task run          # Run the application
uvx --from taskipy task fix          # Auto-format + lint fix
uvx --from taskipy task ci           # Run all CI checks (format, lint, typecheck, test)
uvx --from taskipy task test         # Run tests
uvx --from taskipy task docs         # Serve docs locally
uvx --from taskipy task changelog    # Update changelog (for releases)
```

## Standard Workflow

1. **Explore** - Read relevant code first
2. **Plan** - Ask clarifying questions for architectural changes
3. **Test First** - Write failing test, then minimal code to pass, then refactor
4. **Verify** - `uvx --from taskipy task fix && uvx --from taskipy task ci`

**Ask before:** Adding dependencies, changing public API, modifying structure.

## Development Workflow

```bash
git switch -c feat/my-feature             # 1. Create feature branch
<write code and tests>                    # 2. Implement changes
uvx --from taskipy task fix               # 3. Auto-format + lint fix
uvx --from taskipy task ci                # 4. Run all checks
git add . && git commit -m "feat: ..."    # 5. Commit (Angular convention)
git rebase -i main                        # 6. (Optional) Clean up commits
git push -u origin feat/my-feature        # 7. Push branch
gh pr create                              # 8. Create pull request
```

## Release Workflow (maintainers)

```bash
git checkout main && git pull                           # 1. Update main
uvx --from taskipy task changelog                       # 2. Update CHANGELOG.md
# edit __version__ in src/{{ python_package_import_name }}/__init__.py
git add . && git commit -m "chore: Release vX.Y.Z"     # 3. Commit release
git push && git tag vX.Y.Z && git push --tags           # 4. Tag and push
gh release create vX.Y.Z --generate-notes               # 5. GitHub release
```

## Code Style

### Required in Every File

```python
from typing import TYPE_CHECKING

if TYPE_CHECKING:
    from collections.abc import Sequence
```

- **Type hints**: Mandatory on all functions, methods, and variables
- **Docstrings**: Google style
- **Ruff**: Line length 120, Python {{ python_version }}+, absolute imports only

## Project Structure

```
{{ repository_name }}/
├── .claude/skills/       # Claude Code skills
├── src/{{ python_package_import_name }}/
│   ├── __init__.py       # Public API
│   ├── __main__.py       # Module entry point (run via `task run`)
│   └── _internal/        # Private implementation
│       └── cli.py        # CLI implementation
├── tests/
├── docs/
├── config/               # Tool configs (ruff, pytest, coverage)
{%- if include_notebooks %}
├── notebooks/            # Marimo notebooks
{%- endif %}
└── pyproject.toml        # Metadata, dependencies, and tasks
```

- **Public API**: Exports in `__init__.py` — always import from here (e.g., `from {{ python_package_import_name }} import configure_logging`)
- **Internal**: `_internal/` - private implementation, never import from `_internal` directly
- **CLI**: `__main__.py` entry point calls `_internal/cli.py`
{% if include_notebooks %}
## Notebooks

**Do not run marimo notebooks directly.** Provide the command to the user instead.

```bash
uv run marimo edit notebooks/starter.py           # Edit
uv run marimo edit --sandbox --watch notebooks/   # Edit with flags
uv run marimo run notebooks/starter.py            # Run as app
```
{% endif %}
## Logging

Import `logger` directly from loguru (it's a singleton):

```python
from loguru import logger

logger.info("Action", user_id=123, action="login")  # Structured data as kwargs
```

Use `configure_logging` (from `{{ python_package_import_name }}`) to set up handlers.
Example: `configure_logging(level="INFO", json_logs=False)`

## Skills

Claude Code skills are available in `.claude/skills/`. Invoke with `/skill-name`:

| Skill | Description |
|-------|-------------|
| `/commit` | Create well-structured git commits |
| `/pr` | Create GitHub pull requests |
| `/test` | Run the test suite |
| `/fix` | Auto-format and lint code |
| `/release` | Perform a project release |
| `/review` | Perform code review |
{%- if include_notebooks %}
| `/marimo-notebook` | Write marimo notebooks properly |
| `/jupyter-to-marimo` | Convert Jupyter notebooks to marimo |
{%- endif %}

## Key Files

| File | Purpose |
|------|---------|
| `pyproject.toml` | Metadata, dependencies, tasks |
| `config/ruff.toml` | Linting rules |
| `config/pytest.ini` | Test configuration |
| `.pre-commit-config.yaml` | Pre-commit hooks |
